<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GLITCH TECHS: SYSTEM V3.1</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#030305">
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            cyan: '#06b6d4',
                            pink: '#d946ef',
                            dark: '#030305',
                            panel: 'rgba(10, 12, 16, 0.95)',
                            border: 'rgba(6, 182, 212, 0.3)'
                        }
                    },
                    fontFamily: {
                        sans: ['Rajdhani', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scanline': 'scanline 8s linear infinite',
                    },
                    keyframes: {
                        scanline: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE STYLES --- */
        :root { --primary: #06b6d4; --secondary: #d946ef; }
        body { background-color: #030305; color: #e2e8f0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; user-select: none; }
        
        /* --- FX LAYERS --- */
        .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2)); background-size: 100% 4px; pointer-events: none; z-index: 50; opacity: 0.3; }
        .bg-grid { position: absolute; top: 0; left: 0; width: 200%; height: 200%; background-image: linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px); background-size: 40px 40px; transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px); animation: gridMove 40s linear infinite; z-index: -1; pointer-events: none; }
        @keyframes gridMove { 0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } 100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); } }

        /* --- UI COMPONENTS --- */
        .tech-panel { background: rgba(10, 12, 16, 0.9); border: 1px solid rgba(6, 182, 212, 0.3); backdrop-filter: blur(5px); position: relative; }
        .clip-tech { clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px); }
        .clip-tech-sm { clip-path: polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px); }
        .btn-glitch { position: relative; overflow: hidden; transition: all 0.2s; }
        .btn-glitch:active { transform: scale(0.98); }
        .btn-glitch::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: 0.5s; }
        .btn-glitch:hover::before { left: 100%; }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 2px; }

        /* --- BOOT SEQUENCE --- */
        #boot-screen { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .terminal-text { font-family: 'Share Tech Mono', monospace; color: var(--primary); font-size: 14px; }

        /* --- UTILS --- */
        .text-glow { text-shadow: 0 0 10px rgba(6, 182, 212, 0.7); }
        .hidden-page { display: none !important; }
        .flex-page { display: flex !important; }
        
        select { appearance: none; background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2306b6d4%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 0.7rem top 50%; background-size: 0.65rem auto; }
        
        .skill-node.locked { filter: grayscale(1); opacity: 0.5; }
        .skill-node.unlocked { box-shadow: 0 0 15px rgba(6,182,212,0.3); border-color: #06b6d4; }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="bg-grid"></div>

    <!-- BOOT SCREEN -->
    <div id="boot-screen">
        <div class="w-64">
            <div id="boot-log" class="terminal-text mb-4 h-32 overflow-hidden border-l-2 border-cyan-500 pl-2 opacity-80"></div>
            <div class="h-1 w-full bg-gray-900 rounded overflow-hidden">
                <div id="boot-bar" class="h-full bg-cyan-500 w-0 transition-all duration-200"></div>
            </div>
            <div class="mt-2 flex justify-between terminal-text text-xs">
                <span>SYSTEM V3.1 LOADING</span>
                <span id="boot-pct">0%</span>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="h-16 z-20 bg-black/80 backdrop-blur border-b border-gray-800 flex justify-between items-center px-4 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 tech-panel flex items-center justify-center text-cyan-400 clip-tech-sm">
                <i class="fa-solid fa-bolt"></i>
            </div>
            <div class="leading-none">
                <h1 class="text-xs font-bold tracking-[0.2em] text-white uppercase">SYSTEM <span class="text-green-500">V3.1</span></h1>
                <div class="flex items-center gap-2 text-[10px] font-mono text-gray-400 mt-1">
                    <span id="headerName">HUNTER</span> | LVL <span id="headerLevel" class="text-white">1</span>
                </div>
            </div>
        </div>
        <div class="text-right">
            <div class="flex flex-col items-end">
                <div class="flex items-center gap-2">
                    <span id="goldDisplay" class="font-mono font-bold text-lg text-yellow-400">0</span>
                    <i class="fa-solid fa-coins text-yellow-500 text-xs"></i>
                </div>
                <div class="text-[9px] text-gray-500 uppercase tracking-widest" data-i18n="credits">CREDITS</div>
            </div>
        </div>
    </header>
    
    <!-- XP BAR -->
    <div class="w-full h-1 bg-gray-900 shrink-0 relative">
        <div id="xpBar" class="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 shadow-[0_0_10px_#06b6d4] transition-all duration-1000" style="width: 0%"></div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <main id="main-view" class="flex-1 overflow-hidden relative">
        
        <!-- HUB VIEW -->
        <div id="view-hub" class="page-view h-full w-full p-4 overflow-y-auto pb-20 scrollbar-hide">
            <div class="mb-6 flex justify-between items-end animate-slide-up">
                <div>
                    <div class="text-[10px] text-cyan-500 uppercase tracking-widest mb-1" data-i18n="daily_protocol">Daily Protocol</div>
                    <div class="text-2xl font-bold uppercase font-mono italic text-white" id="greeting">WELCOME BACK</div>
                </div>
                <div class="text-center tech-panel px-3 py-1 clip-tech-sm border-orange-500/30">
                    <div class="text-orange-500 font-bold text-xl"><i class="fa-solid fa-fire"></i> <span id="streakDisplay">0</span></div>
                    <div class="text-[8px] text-gray-400 uppercase" data-i18n="streak">Streak</div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="grid grid-cols-2 gap-3 mb-24">
                
                <div onclick="navTo('operations')" class="col-span-2 tech-panel p-1 clip-tech btn-glitch group cursor-pointer h-32 relative bg-gradient-to-br from-cyan-900/20 to-black">
                    <div class="absolute inset-0 flex items-center justify-center opacity-10 group-hover:opacity-20 transition-opacity">
                        <i class="fa-solid fa-dumbbell text-8xl text-cyan-500"></i>
                    </div>
                    <div class="relative z-10 h-full flex flex-col justify-center items-center text-center">
                        <h2 class="text-2xl font-black italic tracking-widest text-white text-glow" data-i18n="engage">ENGAGE</h2>
                        <p class="font-mono text-xs text-cyan-400 mt-1" data-i18n="engage_desc">START PROTOCOL / LOG DATA</p>
                    </div>
                    <div class="absolute bottom-0 right-0 p-2"><i class="fa-solid fa-arrow-right text-cyan-500 animate-pulse"></i></div>
                </div>

                <div onclick="navTo('profile')" class="tech-panel p-4 clip-tech-sm btn-glitch cursor-pointer flex flex-col justify-between h-24 hover:border-pink-500/50">
                    <div class="flex justify-between items-start"><i class="fa-solid fa-chart-pie text-pink-500 text-xl"></i></div>
                    <div><div class="text-md font-bold text-white" data-i18n="stats">Stats</div><div class="text-[9px] text-gray-500 font-mono" data-i18n="physique">PHYSIQUE</div></div>
                </div>

                <div onclick="navTo('quests')" class="tech-panel p-4 clip-tech-sm btn-glitch cursor-pointer flex flex-col justify-between h-24 hover:border-yellow-500/50">
                    <div class="flex justify-between items-start"><i class="fa-solid fa-scroll text-yellow-500 text-xl"></i><span id="questBadge" class="bg-yellow-500 text-black text-[9px] font-bold px-1.5 rounded">3</span></div>
                    <div><div class="text-md font-bold text-white" data-i18n="missions">Missions</div><div class="text-[9px] text-gray-500 font-mono" data-i18n="targets">TARGETS</div></div>
                </div>
                
                <div onclick="navTo('skills')" class="tech-panel p-4 clip-tech-sm btn-glitch cursor-pointer flex flex-col justify-between h-24 hover:border-blue-500/50">
                    <i class="fa-solid fa-dna text-blue-500 text-xl"></i>
                    <div><div class="text-md font-bold text-white" data-i18n="abilities">Abilities</div><div class="text-[9px] text-gray-500 font-mono" data-i18n="skill_tree">SKILL TREE</div></div>
                </div>

                <div onclick="navTo('achievements')" class="tech-panel p-4 clip-tech-sm btn-glitch cursor-pointer flex flex-col justify-between h-24 hover:border-red-500/50">
                    <i class="fa-solid fa-trophy text-red-500 text-xl"></i>
                    <div><div class="text-md font-bold text-white" data-i18n="trophies">Trophies</div><div class="text-[9px] text-gray-500 font-mono" data-i18n="awards">AWARDS</div></div>
                </div>

                <div onclick="navTo('history')" class="tech-panel p-4 clip-tech-sm btn-glitch cursor-pointer flex flex-col justify-between h-24 hover:border-green-500/50">
                    <i class="fa-solid fa-clock-rotate-left text-green-500 text-xl"></i>
                    <div><div class="text-md font-bold text-white" data-i18n="log">Log</div><div class="text-[9px] text-gray-500 font-mono" data-i18n="history">HISTORY</div></div>
                </div>

                <div onclick="navTo('market')" class="tech-panel p-4 clip-tech-sm btn-glitch cursor-pointer flex flex-col justify-between h-24 hover:border-purple-500/50">
                    <i class="fa-solid fa-shop text-purple-500 text-xl"></i>
                    <div><div class="text-md font-bold text-white" data-i18n="shop">Shop</div><div class="text-[9px] text-gray-500 font-mono" data-i18n="rewards">REWARDS</div></div>
                </div>
            </div>
        </div>

        <!-- OPERATIONS VIEW -->
        <div id="view-operations" class="page-view hidden-page h-full w-full flex flex-col">
            <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between shrink-0">
                <button onclick="navTo('hub')" class="text-gray-500 hover:text-white"><i class="fa-solid fa-chevron-left"></i> HUB</button>
                <h2 class="text-cyan-400 font-bold tracking-widest uppercase" data-i18n="command_center">Command Center</h2>
                <div class="w-8"></div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-20">
                <!-- AI Generator -->
                <div>
                    <h3 class="text-xs text-gray-500 uppercase tracking-widest mb-3 border-b border-gray-800 pb-1" data-i18n="ai_gen">AI Protocol Generator</h3>
                    <button onclick="openGeneratorModal()" class="w-full tech-panel p-4 clip-tech btn-glitch group relative overflow-hidden mb-2">
                        <div class="absolute inset-0 bg-cyan-900/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative flex justify-between items-center z-10">
                            <div class="text-left">
                                <h3 class="text-xl font-black italic text-white uppercase" data-i18n="generate">Generate Protocol</h3>
                                <p class="text-[10px] text-cyan-400 font-mono" data-i18n="gen_desc">CUSTOMIZED BATTLE ROUTINE (HOME/GYM)</p>
                            </div>
                            <i class="fa-solid fa-microchip text-2xl text-cyan-500 animate-pulse"></i>
                        </div>
                    </button>
                </div>

                <!-- Manual Log -->
                <div>
                    <h3 class="text-xs text-gray-500 uppercase tracking-widest mb-3 border-b border-gray-800 pb-1" data-i18n="quick_log">Quick Log</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="openManualLog('strength')" class="tech-panel p-3 clip-tech-sm text-left hover:border-cyan-500 transition-colors btn-glitch">
                            <i class="fa-solid fa-dumbbell text-cyan-500 text-lg mb-1"></i>
                            <div class="font-bold text-white" data-i18n="strength">Strength</div>
                        </button>
                        <button onclick="openManualLog('cardio')" class="tech-panel p-3 clip-tech-sm text-left hover:border-orange-500 transition-colors btn-glitch">
                            <i class="fa-solid fa-person-running text-orange-500 text-lg mb-1"></i>
                            <div class="font-bold text-white" data-i18n="cardio">Cardio</div>
                        </button>
                    </div>
                </div>

                <!-- Presets -->
                <div>
                    <div class="flex justify-between items-end mb-3 border-b border-gray-800 pb-1">
                        <h3 class="text-xs text-gray-500 uppercase tracking-widest" data-i18n="saved_protocols">Saved Protocols</h3>
                        <button onclick="openPresetCreator()" class="text-[10px] text-cyan-500 hover:text-white uppercase"><i class="fa-solid fa-plus mr-1"></i> <span data-i18n="create_new">Create New</span></button>
                    </div>
                    <div id="workout-list" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <!-- SKILLS VIEW (Updated Structure) -->
        <div id="view-skills" class="page-view hidden-page h-full w-full flex flex-col">
            <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between shrink-0">
                <button onclick="navTo('hub')" class="text-gray-500 hover:text-white"><i class="fa-solid fa-chevron-left"></i> HUB</button>
                <h2 class="text-blue-500 font-bold tracking-widest uppercase" data-i18n="skill_tree">Skill Tree</h2>
                <div class="text-xs font-mono text-yellow-400" id="skillCredits">0 CR</div>
            </div>
            <div id="skill-container" class="flex-1 overflow-y-auto p-4 pb-20 relative">
                <!-- Skill tree rendered here -->
            </div>
        </div>

        <!-- ACHIEVEMENTS VIEW -->
        <div id="view-achievements" class="page-view hidden-page h-full w-full flex flex-col">
            <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between shrink-0">
                <button onclick="navTo('hub')" class="text-gray-500 hover:text-white"><i class="fa-solid fa-chevron-left"></i> HUB</button>
                <h2 class="text-red-500 font-bold tracking-widest uppercase" data-i18n="trophies">Trophies</h2>
                <div class="w-8"></div>
            </div>
            <div id="achievement-list" class="flex-1 overflow-y-auto p-4 space-y-3 pb-20">
                <!-- Achievements rendered here -->
            </div>
        </div>

        <!-- OTHER VIEWS (Battle, Profile, Quests, Market, History) -->
        <div id="view-battle" class="page-view hidden-page h-full w-full flex flex-col bg-black">
             <div class="p-3 border-b border-gray-800 bg-gray-900/50 flex justify-between items-center">
                <div><div class="text-[10px] text-gray-500 uppercase">Protocol</div><div id="activeRoutineName" class="text-white font-bold font-mono text-sm">ROUTINE</div></div>
                <div id="sessionTimer" class="font-mono text-xl text-cyan-400">00:00</div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 flex flex-col" id="battle-container">
                <div id="currentExerciseDisplay" class="mb-4">
                     <div class="text-center mb-4">
                        <div class="inline-block border border-cyan-500/30 bg-cyan-900/10 px-3 py-1 text-cyan-400 text-xs font-bold uppercase mb-2 rounded">Ex <span id="currentExIndex">1</span> / <span id="totalExCount">5</span></div>
                        <h2 id="currentExName" class="text-3xl font-black text-white uppercase italic">PUSH UPS</h2>
                        <p id="currentExTarget" class="text-gray-400 font-mono text-sm">Target</p>
                    </div>
                    <div id="setsContainer" class="space-y-2 mb-6"></div>
                </div>
            </div>
            <div class="p-4 bg-gray-900/90 border-t border-gray-800 shrink-0 grid grid-cols-2 gap-3">
                <button onclick="endSession()" class="bg-red-900/50 border border-red-500/50 text-red-500 py-3 font-bold uppercase text-xs clip-tech-sm btn-glitch" data-i18n="abort">Abort</button>
                <button onclick="nextExercise()" id="nextExBtn" class="bg-cyan-600 hover:bg-cyan-500 text-white py-3 font-bold uppercase text-xs clip-tech-sm btn-glitch" data-i18n="next">Next</button>
            </div>
            <div id="restOverlay" class="absolute inset-0 bg-black/95 z-50 hidden flex flex-col items-center justify-center">
                <div class="text-gray-500 text-xs uppercase tracking-[0.3em] mb-4">Recovering</div>
                <div id="restTimerDisplay" class="text-8xl font-mono font-bold text-cyan-400 mb-8 animate-pulse">00:45</div>
                <button onclick="skipRest()" class="bg-white text-black font-bold px-8 py-2 clip-tech-sm hover:bg-cyan-400" data-i18n="engage">ENGAGE</button>
            </div>
        </div>

        <div id="view-profile" class="page-view hidden-page h-full w-full overflow-y-auto p-4 pb-20">
            <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between mb-4"><button onclick="navTo('hub')" class="text-gray-500"><i class="fa-solid fa-chevron-left"></i> HUB</button><h2 class="text-white font-bold uppercase" data-i18n="profile">Profile</h2><div class="w-8"></div></div>
            
            <!-- Language Toggle -->
            <div class="flex justify-end mb-4">
                <button onclick="toggleLanguage()" class="tech-panel px-3 py-1 text-xs text-cyan-400 border-cyan-500/50 hover:bg-cyan-900/20">
                    <i class="fa-solid fa-globe mr-1"></i> <span id="langDisplay">EN</span>
                </button>
            </div>

            <div class="tech-panel p-6 clip-tech mb-6 bg-gradient-to-b from-gray-900 to-black"><div class="flex items-center gap-4"><div class="w-20 h-20 border-2 border-cyan-500 bg-gray-800 flex items-center justify-center text-4xl text-white"><i class="fa-solid fa-user-ninja"></i></div><div><div class="text-xs text-cyan-500 font-bold uppercase">Class: Shadow Monarch</div><div class="text-3xl font-black text-white uppercase italic" id="pName">HUNTER</div><div class="flex items-center gap-2 mt-1"><span class="bg-gray-800 px-2 py-0.5 text-[10px] text-white rounded border border-gray-700" id="pRank">E-RANK</span><span class="text-gray-500 text-xs font-mono">LVL <span id="pLvl">1</span></span></div></div></div></div>
            <div class="tech-panel p-2 mb-6"><div class="text-[10px] text-gray-500 text-center uppercase mb-2">Matrix</div><div class="h-64 relative"><canvas id="radarChart"></canvas></div></div>
            <div class="space-y-2" id="stats-list"></div>
            
            <div class="mt-6 border-t border-gray-800 pt-4 text-center">
                <button onclick="resetData()" class="text-red-500 text-xs hover:text-red-400">RESET DATA</button>
            </div>
        </div>

        <div id="view-quests" class="page-view hidden-page h-full w-full overflow-y-auto p-4 pb-20">
            <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between mb-4"><button onclick="navTo('hub')" class="text-gray-500"><i class="fa-solid fa-chevron-left"></i> HUB</button><h2 class="text-yellow-500 font-bold uppercase" data-i18n="missions">Missions</h2><div class="w-8"></div></div>
            <div id="quest-list" class="space-y-4"></div>
        </div>

        <div id="view-market" class="page-view hidden-page h-full w-full overflow-y-auto p-4 pb-20">
             <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between mb-4"><button onclick="navTo('hub')" class="text-gray-500"><i class="fa-solid fa-chevron-left"></i> HUB</button><h2 class="text-purple-500 font-bold uppercase" data-i18n="shop">Shop</h2><div class="w-8"></div></div>
             <div class="tech-panel p-4 mb-6 border-l-2 border-purple-500"><div class="flex justify-between items-center"><span class="text-gray-400 text-xs uppercase" data-i18n="credits">Credits</span><span class="text-xl font-mono font-bold text-yellow-400" id="marketCredits">0</span></div></div>
             <div id="market-list" class="space-y-3"></div>
             <div class="mt-8 border-t border-gray-800 pt-4"><h4 class="text-[10px] text-gray-500 uppercase mb-2">Custom Reward</h4><div class="flex gap-2"><input type="text" id="newRewardName" placeholder="Item Name" class="flex-1 bg-gray-900 border border-gray-700 text-xs p-3 text-white font-mono"><input type="number" id="newRewardCost" placeholder="Cost" class="w-20 bg-gray-900 border border-gray-700 text-xs p-3 text-white font-mono"><button onclick="addCustomReward()" class="bg-gray-800 px-3 text-gray-300"><i class="fa-solid fa-plus"></i></button></div></div>
        </div>

        <div id="view-history" class="page-view hidden-page h-full w-full overflow-y-auto p-4 pb-20">
            <div class="p-4 border-b border-gray-800 bg-black/80 flex items-center justify-between mb-4"><button onclick="navTo('hub')" class="text-gray-500"><i class="fa-solid fa-chevron-left"></i> HUB</button><h2 class="text-green-500 font-bold uppercase" data-i18n="log">Logs</h2><div class="w-8"></div></div>
            <div id="history-list" class="space-y-2 font-mono text-xs"></div>
        </div>

    </main>

    <!-- GENERATOR MODAL -->
    <div id="generatorModal" class="fixed inset-0 bg-black/90 backdrop-blur z-[150] hidden flex items-center justify-center p-4">
        <div class="tech-panel w-full max-w-sm clip-tech border-cyan-500/50">
            <div class="p-3 border-b border-gray-800 flex justify-between items-center bg-cyan-900/10">
                <h3 class="text-cyan-400 font-mono uppercase text-lg" data-i18n="params">PROTOCOL PARAMETERS</h3>
                <button onclick="closeGeneratorModal()" class="text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div class="text-center text-xs text-gray-400 mb-2" data-i18n="select_env">SELECT ENVIRONMENT</div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="generateProtocol('Home')" class="tech-panel p-4 hover:border-cyan-500 btn-glitch transition-colors">
                        <i class="fa-solid fa-house-laptop text-2xl text-cyan-500 mb-2"></i>
                        <div class="font-bold text-white" data-i18n="home">HOME</div>
                        <div class="text-[9px] text-gray-500">BODYWEIGHT / DUMBBELL</div>
                    </button>
                    <button onclick="generateProtocol('Gym')" class="tech-panel p-4 hover:border-pink-500 btn-glitch transition-colors">
                        <i class="fa-solid fa-dumbbell text-2xl text-pink-500 mb-2"></i>
                        <div class="font-bold text-white" data-i18n="gym">GYM</div>
                        <div class="text-[9px] text-gray-500">MACHINES / BARBELL</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MANUAL INPUT MODAL -->
    <div id="inputModal" class="fixed inset-0 bg-black/90 backdrop-blur z-[150] hidden flex items-center justify-center p-4">
        <div class="tech-panel w-full max-w-sm clip-tech border-cyan-500/50">
            <div class="p-3 border-b border-gray-800 flex justify-between items-center bg-cyan-900/10"><h3 class="text-cyan-400 font-mono uppercase text-lg" id="modalTitle">LOG DATA</h3><button onclick="closeInputModal()" class="text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button></div>
            <div class="p-5 space-y-4">
                <div id="modalFields"></div>
                <div class="grid grid-cols-2 gap-2"><div class="bg-gray-900 border border-gray-800 p-2 text-center"><div class="text-[9px] text-gray-500 uppercase">XP EST</div><div class="text-cyan-400 font-mono text-lg" id="xpPreview">0</div></div><div class="bg-gray-900 border border-gray-800 p-2 text-center"><div class="text-[9px] text-gray-500 uppercase">CREDITS</div><div class="text-yellow-400 font-mono text-lg" id="goldPreview">0</div></div></div>
                <button onclick="submitManualLog()" class="w-full py-3 bg-cyan-700 hover:bg-cyan-600 text-white font-bold uppercase tracking-widest text-sm clip-tech-sm">TRANSMIT DATA</button>
            </div>
        </div>
    </div>

    <!-- PRESET CREATOR MODAL -->
    <div id="createPresetModal" class="fixed inset-0 bg-black/90 backdrop-blur z-[150] hidden flex items-center justify-center p-4">
        <div class="tech-panel w-full max-w-sm clip-tech border-purple-500/50">
            <div class="p-3 border-b border-gray-800 flex justify-between items-center bg-purple-900/10"><h3 class="text-purple-400 font-mono uppercase text-lg">NEW PROTOCOL</h3><button onclick="closePresetModal()" class="text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button></div>
            <div class="p-4 space-y-3">
                <input type="text" id="cpName" placeholder="Protocol Name" class="w-full bg-black border border-gray-700 p-2 text-white text-sm font-mono outline-none">
                <div class="text-xs text-gray-500 uppercase mt-2">Exercises</div>
                <div id="cpExerciseList" class="max-h-32 overflow-y-auto space-y-1 bg-gray-900/50 p-2 border border-gray-800"></div>
                <div class="flex gap-2"><select id="cpExSelect" class="flex-1 bg-black border border-gray-700 text-white text-xs p-2 font-mono"></select><input type="number" id="cpSets" placeholder="Sets" class="w-12 bg-black border border-gray-700 text-white text-xs p-2 text-center"><input type="number" id="cpReps" placeholder="Reps" class="w-12 bg-black border border-gray-700 text-white text-xs p-2 text-center"><button onclick="addExToPreset()" class="bg-gray-800 text-white px-2"><i class="fa-solid fa-plus"></i></button></div>
                <button onclick="saveCustomPreset()" class="w-full py-3 bg-purple-700 hover:bg-purple-600 text-white font-bold uppercase tracking-widest text-sm clip-tech-sm mt-2">SAVE SYSTEM</button>
            </div>
        </div>
    </div>
    
    <!-- SKILL UNLOCK MODAL (New for Bit Tracker Integration) -->
    <div id="skillUnlockModal" class="fixed inset-0 bg-black/95 z-[160] hidden flex flex-col items-center justify-center p-6 text-center">
        <div class="tech-panel w-full max-w-sm p-6 border-cyan-500 shadow-[0_0_30px_rgba(6,182,212,0.3)]">
            <div class="w-16 h-16 mx-auto bg-gray-900 border border-cyan-500/50 rounded-full flex items-center justify-center mb-4 text-2xl text-cyan-400">
                <i id="smIcon" class="fa-solid fa-star"></i>
            </div>
            <h2 id="smTitle" class="text-xl font-bold text-white mb-1 uppercase tracking-wide">Skill Name</h2>
            <div id="smCat" class="text-[10px] text-cyan-400 uppercase tracking-widest mb-4">Category</div>
            <p id="smDesc" class="text-xs text-gray-400 mb-6 font-mono leading-relaxed">Description goes here.</p>
            <div class="bg-gray-900/50 p-3 rounded border border-gray-800 mb-6 text-left">
                <div class="text-[9px] text-gray-500 uppercase tracking-widest mb-2">Requirements</div>
                <ul id="smReqs" class="space-y-1 text-xs font-mono text-gray-300"></ul>
            </div>
            <button id="smUnlockBtn" onclick="unlockSelectedSkill()" class="w-full bg-cyan-700 hover:bg-cyan-600 text-white font-bold py-3 uppercase tracking-widest text-xs border border-cyan-500/50">Awaken Ability</button>
            <button onclick="closeSkillModal()" class="mt-3 text-[10px] text-gray-500 hover:text-white uppercase tracking-widest">Close</button>
        </div>
    </div>

    <!-- TOAST & LEVEL UP -->
    <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 bg-black border border-cyan-500 shadow-[0_0_20px_rgba(6,182,212,0.3)] p-4 z-[200] transition-all duration-300 translate-y-[-150%] flex items-center gap-3 min-w-[300px] clip-tech-sm"><i class="fa-solid fa-circle-info text-cyan-500"></i><div><div class="text-[10px] text-cyan-500 uppercase font-bold tracking-widest">System Alert</div><div id="toastMsg" class="text-white text-xs font-mono">Message content</div></div></div>
    <div id="levelUpModal" class="fixed inset-0 bg-black/95 z-[200] hidden flex flex-col items-center justify-center p-6 text-center"><div class="text-cyan-500 text-6xl mb-4 animate-bounce"><i class="fa-solid fa-arrow-up-from-bracket"></i></div><h1 class="text-4xl font-black text-white italic uppercase mb-2 tracking-widest text-glow">Level Up!</h1><div class="text-2xl font-bold text-white mb-8 border-y border-gray-800 py-4 w-full">LEVEL <span id="oldLvl" class="text-gray-500">1</span> <i class="fa-solid fa-right-long mx-2 text-cyan-500"></i> <span id="newLvl" class="text-cyan-400">2</span></div><button onclick="closeLevelModal()" class="bg-cyan-600 text-white py-3 px-8 uppercase font-bold tracking-widest clip-tech btn-glitch">ACKNOWLEDGE</button></div>

    <script>
        // --- TRANSLATIONS & CONSTANTS ---
        const TRANSLATIONS = {
            en: {
                credits: "CREDITS", daily_protocol: "Daily Protocol", streak: "Streak",
                engage: "ENGAGE", engage_desc: "START PROTOCOL / LOG DATA",
                stats: "Stats", physique: "PHYSIQUE",
                missions: "Missions", targets: "TARGETS",
                abilities: "Abilities", skill_tree: "SKILL TREE",
                trophies: "Trophies", awards: "AWARDS",
                log: "Log", history: "HISTORY",
                shop: "Shop", rewards: "REWARDS",
                command_center: "Command Center", ai_gen: "AI Protocol Generator",
                generate: "Generate Protocol", gen_desc: "CUSTOMIZED BATTLE ROUTINE (HOME/GYM)",
                quick_log: "Quick Log", strength: "Strength", cardio: "Cardio",
                saved_protocols: "Saved Protocols", create_new: "Create New",
                abort: "Abort", next: "Next", profile: "Profile",
                params: "PROTOCOL PARAMETERS", select_env: "SELECT ENVIRONMENT",
                home: "HOME", gym: "GYM"
            },
            pt: {
                credits: "CRÉDITOS", daily_protocol: "Protocolo Diário", streak: "Sequência",
                engage: "INICIAR", engage_desc: "INICIAR TREINO / REGISTRO",
                stats: "Status", physique: "FÍSICO",
                missions: "Missões", targets: "ALVOS",
                abilities: "Habilidades", skill_tree: "ÁRVORE DE SKILLS",
                trophies: "Troféus", awards: "PRÊMIOS",
                log: "Registro", history: "HISTÓRICO",
                shop: "Loja", rewards: "RECOMPENSAS",
                command_center: "Centro de Comando", ai_gen: "Gerador IA",
                generate: "Gerar Protocolo", gen_desc: "ROTINA DE BATALHA (CASA/ACADEMIA)",
                quick_log: "Registro Rápido", strength: "Força", cardio: "Cardio",
                saved_protocols: "Protocolos Salvos", create_new: "Criar Novo",
                abort: "Abortar", next: "Próximo", profile: "Perfil",
                params: "PARÂMETROS", select_env: "SELECIONAR AMBIENTE",
                home: "CASA", gym: "ACADEMIA"
            }
        };

        // --- SKILL TREE DATA (IMPORTED FROM BIT TRACKER) ---
        const SKILL_TREE = [
            { id: 'push1', name: 'Push Ups', cat: 'Striker', icon: 'fa-hand-back-fist', tier: 1, req: [], desc: 'The foundation of all pushing strength. Master your bodyweight.' },
            { id: 'push2', name: 'Diamond Push Ups', cat: 'Striker', icon: 'fa-gem', tier: 2, req: ['push1'], desc: 'Close grip push ups targeting triceps and inner chest.' },
            { id: 'push3', name: 'Dips', cat: 'Striker', icon: 'fa-bars', tier: 2, req: ['push1'], desc: 'Vertical pushing power. The upper body squat.' },
            { id: 'push4', name: 'Archer Push Ups', cat: 'Striker', icon: 'fa-bow-arrow', tier: 3, req: ['push2'], desc: 'Unilateral loading, preparing for the one arm push up.' },
            { id: 'push5', name: 'One Arm Push Up', cat: 'Striker', icon: 'fa-hand-fist', tier: 4, req: ['push4'], desc: 'The ultimate display of unilateral pushing strength.' },
            { id: 'push6', name: 'Handstand Hold', cat: 'Striker', icon: 'fa-person-running', tier: 3, req: ['push3'], desc: 'Static overhead stability. Balance meets strength.' },
            { id: 'push7', name: 'Handstand Push Up', cat: 'Striker', icon: 'fa-arrows-down-to-line', tier: 4, req: ['push6'], desc: 'Vertical pushing mastery against gravity.' },
            { id: 'push8', name: 'Planche Lean', cat: 'Striker', icon: 'fa-ruler-horizontal', tier: 3, req: ['push2'], desc: 'Building straight arm strength.' },
            { id: 'push9', name: 'Full Planche', cat: 'Striker', icon: 'fa-plane', tier: 5, req: ['push8'], desc: 'God-tier static strength. Defy gravity.' },

            { id: 'pull1', name: 'Pull Ups', cat: 'Assassin', icon: 'fa-arrow-up', tier: 1, req: [], desc: 'The king of back exercises.' },
            { id: 'pull2', name: 'L-Sit Pull Ups', cat: 'Assassin', icon: 'fa-chair', tier: 2, req: ['pull1'], desc: 'Engage the core while pulling.' },
            { id: 'pull3', name: 'Explosive Pull Ups', cat: 'Assassin', icon: 'fa-explosion', tier: 2, req: ['pull1'], desc: 'Pulling high to the chest or waist.' },
            { id: 'pull4', name: 'Muscle Up', cat: 'Assassin', icon: 'fa-angle-double-up', tier: 4, req: ['pull3', 'push3'], desc: 'Transition from pull to push in one fluid motion.' },
            { id: 'pull5', name: 'Front Lever Tuck', cat: 'Assassin', icon: 'fa-anchor', tier: 3, req: ['pull2'], desc: 'Intro to straight arm pulling strength.' },
            { id: 'pull6', name: 'Front Lever', cat: 'Assassin', icon: 'fa-scale-balanced', tier: 5, req: ['pull5'], desc: 'Horizontal static hold. Pure lat dominance.' },
            { id: 'pull7', name: 'One Arm Pull Up', cat: 'Assassin', icon: 'fa-1', tier: 5, req: ['pull3'], desc: 'The pinnacle of vertical pulling strength.' },

            { id: 'core1', name: 'Plank', cat: 'Tank', icon: 'fa-minus', tier: 1, req: [], desc: 'Static core stability.' },
            { id: 'core2', name: 'Leg Raises', cat: 'Tank', icon: 'fa-arrow-turn-up', tier: 2, req: ['core1'], desc: 'Dynamic compression strength.' },
            { id: 'core3', name: 'L-Sit', cat: 'Tank', icon: 'fa-chair', tier: 3, req: ['core2', 'push3'], desc: 'Support hold requiring immense core and tricep strength.' },
            { id: 'core4', name: 'Dragon Flag', cat: 'Tank', icon: 'fa-dragon', tier: 4, req: ['core2'], desc: 'The legendary Bruce Lee move.' },
            { id: 'core5', name: 'Human Flag', cat: 'Tank', icon: 'fa-flag', tier: 5, req: ['core4', 'push6'], desc: 'Lateral chain mastery.' },

            { id: 'leg1', name: 'Squats', cat: 'Legion', icon: 'fa-person', tier: 1, req: [], desc: 'Fundamental leg strength.' },
            { id: 'leg2', name: 'Jump Squats', cat: 'Legion', icon: 'fa-frog', tier: 2, req: ['leg1'], desc: 'Explosive lower body power.' },
            { id: 'leg3', name: 'Pistol Squat', cat: 'Legion', icon: 'fa-gun', tier: 4, req: ['leg1'], desc: 'Single leg squat requiring balance and mobility.' },
            
            { id: 'run1', name: 'Runner', cat: 'Monarch', icon: 'fa-person-running', tier: 1, req: [], desc: 'Basic endurance.' },
            { id: 'god1', name: 'Shadow Step', cat: 'Monarch', icon: 'fa-ghost', tier: 2, req: ['run1'], desc: 'Run 1km in under 4 minutes.' }
        ];

        // Exercise DB
        const FULL_EXERCISE_DB = [
            // Home / Bodyweight
            { name: "Push Ups", type: "Home", muscle: "Chest", cat: "Push" },
            { name: "Diamond Push Ups", type: "Home", muscle: "Arms", cat: "Push" },
            { name: "Pike Push Ups", type: "Home", muscle: "Shoulders", cat: "Push" },
            { name: "Pull Ups", type: "Home", muscle: "Back", cat: "Pull" },
            { name: "Chin Ups", type: "Home", muscle: "Back", cat: "Pull" },
            { name: "Squats", type: "Home", muscle: "Legs", cat: "Legs" },
            { name: "Lunges", type: "Home", muscle: "Legs", cat: "Legs" },
            { name: "Jump Squats", type: "Home", muscle: "Legs", cat: "Legs" },
            { name: "Calf Raises", type: "Home", muscle: "Legs", cat: "Legs" },
            { name: "Burpees", type: "Home", muscle: "Cardio", cat: "Cardio" },
            { name: "Plank", type: "Home", muscle: "Core", cat: "Core", isTime: true },
            { name: "Leg Raises", type: "Home", muscle: "Core", cat: "Core" },
            // Gym / Equipment
            { name: "Bench Press", type: "Gym", muscle: "Chest", cat: "Push" },
            { name: "Incline Dumbbell Press", type: "Gym", muscle: "Chest", cat: "Push" },
            { name: "Overhead Press", type: "Gym", muscle: "Shoulders", cat: "Push" },
            { name: "Cable Flyes", type: "Gym", muscle: "Chest", cat: "Push" },
            { name: "Lat Pulldown", type: "Gym", muscle: "Back", cat: "Pull" },
            { name: "Barbell Row", type: "Gym", muscle: "Back", cat: "Pull" },
            { name: "Face Pulls", type: "Gym", muscle: "Shoulders", cat: "Pull" },
            { name: "Deadlift", type: "Gym", muscle: "Back", cat: "Pull" },
            { name: "Leg Press", type: "Gym", muscle: "Legs", cat: "Legs" },
            { name: "Hamstring Curls", type: "Gym", muscle: "Legs", cat: "Legs" },
            { name: "Cable Crunches", type: "Gym", muscle: "Core", cat: "Core" }
        ];

        const ACHIEVEMENTS = [
            { id: 'first_blood', name: 'First Blood', desc: 'Complete your first workout', reward: 100, unlocked: false },
            { id: 'consistent', name: 'System Stable', desc: 'Reach 3 day streak', reward: 300, unlocked: false },
            { id: 'veteran', name: 'Veteran Hunter', desc: 'Reach Level 5', reward: 1000, unlocked: false },
            { id: 'rich', name: 'Crypto Miner', desc: 'Amass 1000 Credits', reward: 200, unlocked: false },
            { id: 'iron_body', name: 'Iron Body', desc: 'Complete 1000 total reps (Lifetime)', reward: 500, unlocked: false }
        ];

        const PRESETS = {
            'daily': { name: "Daily Protocol", desc: "Consistency Check", exercises: [
                { name: "Push Ups", sets: 3, reps: 20, type: "Rep Based" },
                { name: "Squats", sets: 3, reps: 20, type: "Rep Based" },
                { name: "Plank", sets: 3, time: 60, type: "Time Based" }
            ]}
        };

        const DEFAULT_STATE = {
            name: "Hunter", level: 1, xp: 0, xpNext: 500, gold: 0, streak: 0, lastLogin: null,
            lang: 'en', // New language field
            stats: { str: 10, agi: 10, end: 10 },
            mastery: { Chest: 1, Back: 1, Legs: 1, Arms: 1, Core: 1 },
            quests: [], history: [], customPresets: {},
            skills: ['push1', 'pull1', 'core1', 'leg1', 'run1'], // Default unlocked from new tree
            achievements: [],
            rewards: [{ id: 1, name: "Cheat Meal", cost: 500 }, { id: 2, name: "Rest Day", cost: 300 }],
            totalReps: 0
        };

        let db = JSON.parse(localStorage.getItem('glitchGymDB_v3')) || JSON.parse(JSON.stringify(DEFAULT_STATE));
        // Migration Check for Bit Tracker Data
        let oldData = localStorage.getItem('rpgFitProfiles');
        if (oldData && (!db.migratedFromBitTracker)) {
            try {
                let profiles = JSON.parse(oldData);
                let currentId = localStorage.getItem('rpgFitCurrentProfile') || Object.keys(profiles)[0];
                let profile = profiles[currentId];
                if(profile) {
                    console.log("Migrating Bit Tracker Data...");
                    db.name = profile.name || db.name;
                    db.level = profile.level || db.level;
                    db.xp = profile.xp || db.xp;
                    db.gold = profile.gold || db.gold;
                    db.streak = profile.streak || db.streak;
                    // Migrate Skills: Map 'unlockedSkills' to 'skills'
                    if (profile.unlockedSkills && Array.isArray(profile.unlockedSkills)) {
                        // Merge avoiding duplicates
                        db.skills = [...new Set([...db.skills, ...profile.unlockedSkills])];
                    }
                    // Migrate Stats
                    if (profile.stats) {
                        db.stats.str = profile.stats.str || 10;
                        db.stats.agi = profile.stats.agi || 10;
                        db.stats.end = profile.stats.end || 10;
                    }
                    db.migratedFromBitTracker = true;
                    localStorage.setItem('glitchGymDB_v3', JSON.stringify(db));
                }
            } catch(e) { console.error("Migration Error", e); }
        }

        // Basic safety check for array fields
        if(!db.achievements) db.achievements = [];
        if(!db.skills) db.skills = ['push1', 'pull1', 'core1', 'leg1', 'run1'];
        if(!db.lang) db.lang = 'en';
        
        let activeSession = null;
        let restInterval = null;
        let sessionTimerInterval = null;
        let chartInstance = null;
        let manualLogType = '';
        let tempPresetExercises = [];
        let selectedSkillId = null;

        // --- INIT ---
        window.onload = function() { runBootSequence(); };

        function runBootSequence() {
            const screen = document.getElementById('boot-screen');
            const log = document.getElementById('boot-log');
            const bar = document.getElementById('boot-bar');
            const pct = document.getElementById('boot-pct');
            const logs = ["CONNECTING TO NEURAL LINK...", "DETECTING LEGACY DATA...", "IMPORTING SKILL MATRIX...", "OPTIMIZING ALGORITHMS...", "SYSTEM ONLINE."];
            let i = 0;
            const logInt = setInterval(() => {
                if(i < logs.length) {
                    log.innerHTML += `<div>> ${logs[i]}</div>`;
                    log.scrollTop = log.scrollHeight;
                    i++;
                    bar.style.width = (i/logs.length * 100) + "%";
                    pct.innerText = Math.floor(i/logs.length * 100) + "%";
                } else {
                    clearInterval(logInt);
                    setTimeout(() => { screen.style.opacity = '0'; setTimeout(() => { screen.style.display = 'none'; initApp(); }, 500); }, 500);
                }
            }, 200);
        }

        function initApp() {
            checkDailyLogin();
            applyLanguage();
            updateHeader();
            renderHub();
            checkAchievements();
        }

        // --- LANGUAGE & TRANSLATION ---
        function toggleLanguage() {
            db.lang = db.lang === 'en' ? 'pt' : 'en';
            saveDB();
            applyLanguage();
        }

        function applyLanguage() {
            const t = TRANSLATIONS[db.lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerText = t[key];
            });
            document.getElementById('langDisplay').innerText = db.lang.toUpperCase();
            renderHub(); // Re-render dynamic content
            if(!document.getElementById('view-skills').classList.contains('hidden-page')) renderSkills();
        }

        // --- CORE LOGIC ---
        function checkDailyLogin() {
            const today = new Date().toDateString();
            if (db.lastLogin !== today) {
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                if (db.lastLogin === yesterday.toDateString()) { db.streak++; } 
                else if (db.lastLogin !== null && db.lastLogin !== today) {
                    db.streak = 0; 
                }
                if (db.lastLogin === null) db.streak = 1;
                db.lastLogin = today;
                generateDailyQuests();
                saveDB();
            }
        }

        function generateDailyQuests() {
            const types = ['Push Ups', 'Squats', 'Burpees', 'Plank'];
            const quests = [];
            for(let i=0; i<3; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const amt = Math.floor(Math.random() * 3 + 1) * 10;
                quests.push({ id: Date.now() + i, title: `${type} Drill`, desc: `Complete ${amt} ${type}`, target: amt, current: 0, reward: amt * 5, done: false, type: type });
            }
            db.quests = quests;
        }

        function navTo(pageId) {
            document.querySelectorAll('.page-view').forEach(p => { p.classList.add('hidden-page'); p.classList.remove('flex-page'); });
            const page = document.getElementById('view-' + pageId);
            page.classList.remove('hidden-page');
            if(pageId === 'battle') page.classList.add('flex-page');
            if(pageId === 'skills') page.classList.add('flex-page');
            if(pageId === 'achievements') page.classList.add('flex-page');
            
            if (pageId === 'profile') renderProfile();
            if (pageId === 'operations') renderOperations();
            if (pageId === 'quests') renderQuests();
            if (pageId === 'market') renderMarket();
            if (pageId === 'history') renderHistory();
            if (pageId === 'hub') renderHub();
            if (pageId === 'skills') renderSkills();
            if (pageId === 'achievements') renderAchievements();
        }

        function updateHeader() {
            document.getElementById('headerLevel').innerText = db.level;
            document.getElementById('goldDisplay').innerText = db.gold;
            document.getElementById('xpBar').style.width = (db.xp / db.xpNext * 100) + "%";
            document.getElementById('questBadge').innerText = db.quests.filter(q => !q.done).length;
        }

        function renderHub() {
            document.getElementById('streakDisplay').innerText = db.streak;
            const hour = new Date().getHours();
            let greet = hour < 12 ? "GOOD MORNING" : hour < 18 ? "GOOD AFTERNOON" : "GOOD EVENING";
            if(db.lang === 'pt') greet = hour < 12 ? "BOM DIA" : hour < 18 ? "BOA TARDE" : "BOA NOITE";
            document.getElementById('greeting').innerText = greet;
        }

        // --- SKILLS (UPDATED) ---
        function renderSkills() {
            document.getElementById('skillCredits').innerText = db.gold + ' CR';
            const c = document.getElementById('skill-container');
            c.innerHTML = '';
            
            const categories = [...new Set(SKILL_TREE.map(s => s.cat))];

            categories.forEach(cat => {
                const skills = SKILL_TREE.filter(s => s.cat === cat).sort((a,b) => a.tier - b.tier);
                let html = `<div class="mb-6">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-3 pl-2 border-l-2 border-cyan-500">${cat} PATH</h3>
                    <div class="flex flex-wrap gap-3 items-center justify-start">`;
                
                skills.forEach(skill => {
                    const isUnlocked = db.skills.includes(skill.id);
                    const borderColor = isUnlocked ? 'border-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.3)]' : 'border-gray-700 opacity-60 grayscale';
                    const iconColor = isUnlocked ? 'text-cyan-400' : 'text-gray-600';
                    const bgClass = isUnlocked ? 'bg-cyan-900/20' : 'bg-gray-900/50';

                    html += `
                        <div onclick="openSkillModal('${skill.id}')" class="skill-node relative cursor-pointer w-14 h-14 rounded-lg border ${borderColor} ${bgClass} flex flex-col items-center justify-center transition-all active:scale-95">
                            <i class="fa-solid ${skill.icon} text-lg ${iconColor} mb-1"></i>
                            ${isUnlocked ? '<div class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-500 rounded-full border border-black"></div>' : ''}
                        </div>
                    `;
                });
                
                html += `</div></div>`;
                c.innerHTML += html;
            });
        }

        function openSkillModal(skillId) {
            selectedSkillId = skillId;
            const skill = SKILL_TREE.find(s => s.id === skillId);
            if(!skill) return;

            const isUnlocked = db.skills.includes(skillId);
            const m = document.getElementById('skillUnlockModal');
            
            document.getElementById('smIcon').className = `fa-solid ${skill.icon}`;
            document.getElementById('smTitle').innerText = skill.name;
            document.getElementById('smCat').innerText = `${skill.cat} | Tier ${skill.tier}`;
            document.getElementById('smDesc').innerText = skill.desc;

            let reqHtml = '';
            let canUnlock = true;
            if(skill.req.length === 0) {
                reqHtml = '<li class="text-green-500">Starter Skill</li>';
            } else {
                skill.req.forEach(reqId => {
                    const reqSkill = SKILL_TREE.find(s => s.id === reqId);
                    const reqMet = db.skills.includes(reqId);
                    if(!reqMet) canUnlock = false;
                    reqHtml += `<li class="${reqMet ? 'text-green-500' : 'text-red-500'}"><i class="fa-solid ${reqMet ? 'fa-check' : 'fa-xmark'} mr-1"></i> ${reqSkill ? reqSkill.name : reqId}</li>`;
                });
            }
            document.getElementById('smReqs').innerHTML = reqHtml;

            const btn = document.getElementById('smUnlockBtn');
            const cost = skill.tier * 200; // Cost calculation
            
            if(isUnlocked) {
                btn.innerText = "UNLOCKED";
                btn.className = "w-full bg-green-900/30 text-green-400 font-bold py-3 uppercase tracking-widest text-xs border border-green-500/50 cursor-default";
                btn.onclick = null;
            } else if (canUnlock) {
                if(db.gold >= cost) {
                    btn.innerText = `UNLOCK (${cost} CR)`;
                    btn.className = "w-full bg-cyan-700 hover:bg-cyan-600 text-white font-bold py-3 uppercase tracking-widest text-xs border border-cyan-500/50 btn-glitch";
                    btn.onclick = () => unlockSelectedSkill(cost);
                } else {
                    btn.innerText = `NEED ${cost} CR`;
                    btn.className = "w-full bg-gray-800 text-gray-500 font-bold py-3 uppercase tracking-widest text-xs border border-gray-600 cursor-not-allowed";
                    btn.onclick = null;
                }
            } else {
                btn.innerText = "LOCKED";
                btn.className = "w-full bg-gray-800 text-gray-500 font-bold py-3 uppercase tracking-widest text-xs border border-gray-600 cursor-not-allowed";
                btn.onclick = null;
            }

            m.classList.remove('hidden');
            m.classList.add('flex');
        }

        function closeSkillModal() {
            document.getElementById('skillUnlockModal').classList.add('hidden');
            document.getElementById('skillUnlockModal').classList.remove('flex');
        }

        function unlockSelectedSkill(cost) {
            if(db.gold >= cost) {
                db.gold -= cost;
                db.skills.push(selectedSkillId);
                const skill = SKILL_TREE.find(s => s.id === selectedSkillId);
                // Stat boosts
                if(skill.cat === 'Striker') db.stats.str += 1;
                if(skill.cat === 'Assassin') db.stats.agi += 1;
                if(skill.cat === 'Tank') db.stats.end += 1;
                
                saveDB();
                renderSkills();
                closeSkillModal();
                updateHeader();
                showToast(`Skill Unlocked: ${skill.name}`);
            }
        }

        // --- PROTOCOL GENERATOR (Home/Gym) ---
        function openGeneratorModal() { document.getElementById('generatorModal').classList.remove('hidden'); document.getElementById('generatorModal').classList.add('flex'); }
        function closeGeneratorModal() { document.getElementById('generatorModal').classList.add('hidden'); document.getElementById('generatorModal').classList.remove('flex'); }

        function generateProtocol(env) {
            closeGeneratorModal();
            const available = FULL_EXERCISE_DB.filter(e => e.type === env || e.type === 'Home'); 
            const getEx = (cat) => {
                const pool = available.filter(e => e.cat === cat);
                return pool[Math.floor(Math.random() * pool.length)];
            };

            const routine = [
                getEx('Push'),
                getEx('Pull'),
                getEx('Legs'),
                getEx('Core'),
                available[Math.floor(Math.random() * available.length)] 
            ];

            const exercises = routine.map(e => ({
                name: e.name,
                sets: 3,
                reps: e.isTime ? null : (env === 'Home' ? 15 : 10),
                time: e.isTime ? 45 : null,
                type: e.isTime ? 'Time Based' : 'Rep Based'
            }));

            const routineName = `AI-${env.toUpperCase()}`;
            startSessionDirect({ name: routineName, desc: `${env} Auto-Gen`, exercises: exercises });
        }

        // --- BATTLE & PRESETS (Reused) ---
        function renderOperations() {
            const list = document.getElementById('workout-list');
            list.innerHTML = '';
            let ALL_PRESETS = { ...PRESETS, ...db.customPresets };
            Object.keys(ALL_PRESETS).forEach(key => {
                const p = ALL_PRESETS[key];
                list.innerHTML += `<div onclick="startSession('${key}')" class="tech-panel p-4 clip-tech btn-glitch cursor-pointer group hover:bg-cyan-900/20 transition-colors"><div class="flex justify-between items-center mb-2"><h3 class="text-xl font-bold text-white italic">${p.name.toUpperCase()}</h3><i class="fa-solid fa-play text-cyan-500 group-hover:scale-125 transition-transform"></i></div><p class="text-xs text-gray-400 font-mono mb-3">${p.desc}</p><div class="flex flex-wrap gap-2">${p.exercises.map(e => `<span class="bg-black border border-gray-800 text-[9px] px-2 py-1 text-gray-500 rounded">${e.name}</span>`).join('')}</div></div>`;
            });
        }
        function startSession(key) { startSessionDirect({ ...PRESETS, ...db.customPresets }[key]); }
        
        function startSessionDirect(presetData) {
            activeSession = {
                id: Date.now(),
                routine: presetData.name,
                startTime: Date.now(),
                exercises: JSON.parse(JSON.stringify(presetData.exercises)),
                currentExIndex: 0,
                logs: []
            };
            activeSession.exercises.forEach(ex => {
                ex.setsData = [];
                for(let i=0; i<ex.sets; i++) { ex.setsData.push({ completed: false, val: ex.reps || ex.time }); }
            });
            document.getElementById('activeRoutineName').innerText = presetData.name;
            startSessionTimer();
            renderActiveExercise();
            navTo('battle');
        }

        function startSessionTimer() {
            clearInterval(sessionTimerInterval);
            const start = Date.now();
            const display = document.getElementById('sessionTimer');
            sessionTimerInterval = setInterval(() => {
                const diff = Math.floor((Date.now() - start) / 1000);
                const m = Math.floor(diff / 60).toString().padStart(2, '0');
                const s = (diff % 60).toString().padStart(2, '0');
                display.innerText = `${m}:${s}`;
            }, 1000);
        }

        function renderActiveExercise() {
            const ex = activeSession.exercises[activeSession.currentExIndex];
            document.getElementById('currentExIndex').innerText = activeSession.currentExIndex + 1;
            document.getElementById('totalExCount').innerText = activeSession.exercises.length;
            document.getElementById('currentExName').innerText = ex.name;
            document.getElementById('currentExTarget').innerText = ex.type === 'Time Based' ? `Target: ${ex.sets} Sets x ${ex.time}s` : `Target: ${ex.sets} Sets x ${ex.reps} Reps`;
            
            const container = document.getElementById('setsContainer');
            container.innerHTML = '';
            ex.setsData.forEach((set, idx) => {
                container.innerHTML += `<div class="flex items-center gap-3 bg-gray-900/50 p-2 rounded border ${set.completed ? 'border-green-500/50' : 'border-gray-700'} transition-all"><div class="w-8 text-center text-gray-500 font-mono text-xs">SET ${idx+1}</div><input type="number" value="${set.val}" id="set-val-${idx}" class="bg-black border border-gray-600 w-16 text-center text-white py-2 rounded focus:border-cyan-500 outline-none font-mono" ${set.completed?'disabled':''}><button onclick="completeSet(${idx})" class="flex-1 py-2 font-bold uppercase text-xs rounded transition-colors ${set.completed ? 'bg-green-600 text-white' : 'bg-gray-700 hover:bg-gray-600 text-gray-300'}">${set.completed ? '<i class="fa-solid fa-check"></i>' : 'LOG'}</button></div>`;
            });
            const allDone = ex.setsData.every(s => s.completed);
            const btn = document.getElementById('nextExBtn');
            if (activeSession.currentExIndex >= activeSession.exercises.length - 1) {
                btn.innerHTML = 'FINISH';
                btn.onclick = allDone ? endSession : () => showToast("Complete sets!");
                btn.className = allDone ? "bg-green-600 hover:bg-green-500 text-white py-3 font-bold uppercase text-xs clip-tech-sm btn-glitch" : "bg-gray-700 text-gray-500 py-3 font-bold uppercase text-xs clip-tech-sm cursor-not-allowed";
            } else {
                btn.innerHTML = 'NEXT';
                btn.onclick = nextExercise;
            }
        }

        function completeSet(idx) {
            const ex = activeSession.exercises[activeSession.currentExIndex];
            const val = parseInt(document.getElementById(`set-val-${idx}`).value);
            ex.setsData[idx].val = val;
            ex.setsData[idx].completed = true;
            if(ex.type !== 'Time Based') db.totalReps += val;
            checkQuestProgress(ex.name, val);
            addXP(15); saveDB(); renderActiveExercise();
            if (idx < ex.setsData.length - 1) triggerRest(45);
        }

        function triggerRest(s) {
            const o = document.getElementById('restOverlay');
            const d = document.getElementById('restTimerDisplay');
            o.classList.remove('hidden');
            let t = s; d.innerText = `00:${t}`;
            if(restInterval) clearInterval(restInterval);
            restInterval = setInterval(() => { t--; d.innerText = `00:${t.toString().padStart(2,'0')}`; if(t<=0) skipRest(); }, 1000);
        }
        function skipRest() { clearInterval(restInterval); document.getElementById('restOverlay').classList.add('hidden'); }
        function nextExercise() { if(activeSession.currentExIndex < activeSession.exercises.length - 1) { activeSession.currentExIndex++; renderActiveExercise(); } }
        
        function endSession() {
            clearInterval(sessionTimerInterval);
            const duration = Math.floor((Date.now() - activeSession.startTime)/1000/60);
            const totalSets = activeSession.exercises.reduce((acc, ex) => acc + ex.setsData.filter(s=>s.completed).length, 0);
            let xp = totalSets * 20 + duration * 5;
            let gold = Math.floor(xp / 2);
            addXP(xp); db.gold += gold;
            db.history.unshift({ date: new Date().toLocaleString(), desc: `${activeSession.routine} (${duration}m)`, xp: xp });
            if(db.history.length > 20) db.history.pop();
            saveDB(); checkAchievements(); showToast(`Mission Complete! +${xp} XP`); navTo('hub'); activeSession = null;
        }

        // --- MANUAL, PRESETS, QUESTS, MARKET ---
        function openManualLog(type) {
            manualLogType = type;
            document.getElementById('inputModal').classList.remove('hidden'); document.getElementById('inputModal').classList.add('flex');
            const f = document.getElementById('modalFields');
            if(type==='strength') {
                const opts = FULL_EXERCISE_DB.map(e => `<option value="${e.name}">${e.name}</option>`).join('');
                f.innerHTML = `<select id="mlEx" class="w-full bg-black border border-gray-700 p-3 text-white text-xs font-mono mb-3">${opts}</select><div class="flex gap-2"><input type="number" id="mlSets" placeholder="Sets" class="w-1/2 bg-black border border-gray-700 p-3 text-white text-xs font-mono" oninput="calcManualPreview()"><input type="number" id="mlReps" placeholder="Reps" class="w-1/2 bg-black border border-gray-700 p-3 text-white text-xs font-mono" oninput="calcManualPreview()"></div>`;
            } else {
                f.innerHTML = `<select id="mlEx" class="w-full bg-black border border-gray-700 p-3 text-white text-xs font-mono mb-3"><option>Running</option><option>Cycling</option></select><input type="number" id="mlTime" placeholder="Time (min)" class="w-full bg-black border border-gray-700 p-3 text-white text-xs font-mono" oninput="calcManualPreview()">`;
            }
            calcManualPreview();
        }
        function calcManualPreview() {
            let xp = 0;
            if(manualLogType==='strength') { xp = (document.getElementById('mlSets').value||0) * (document.getElementById('mlReps').value||0) * 1.5; }
            else { xp = (document.getElementById('mlTime').value||0) * 5; }
            document.getElementById('xpPreview').innerText = Math.floor(xp);
            document.getElementById('goldPreview').innerText = Math.floor(xp/2);
        }
        function submitManualLog() {
            const xp = parseInt(document.getElementById('xpPreview').innerText);
            const gold = parseInt(document.getElementById('goldPreview').innerText);
            const exName = document.getElementById('mlEx').value;
            if(manualLogType === 'strength') {
                 const r = parseInt(document.getElementById('mlReps').value || 0);
                 const s = parseInt(document.getElementById('mlSets').value || 0);
                 db.totalReps += (r * s);
                 checkQuestProgress(exName, r*s);
            } else {
                 checkQuestProgress(exName, parseInt(document.getElementById('mlTime').value || 0));
            }
            addXP(xp); db.gold += gold; 
            db.history.unshift({date: new Date().toLocaleString(), desc: "Manual: " + exName, xp: xp});
            saveDB(); closeInputModal(); checkAchievements(); showToast("Logged");
        }
        function closeInputModal() { document.getElementById('inputModal').classList.add('hidden'); document.getElementById('inputModal').classList.remove('flex'); }

        function openPresetCreator() {
            tempPresetExercises = [];
            document.getElementById('createPresetModal').classList.remove('hidden'); document.getElementById('createPresetModal').classList.add('flex');
            document.getElementById('cpExSelect').innerHTML = FULL_EXERCISE_DB.map(e => `<option value="${e.name}">${e.name}</option>`).join('');
            renderPresetExList();
        }
        function closePresetModal() { document.getElementById('createPresetModal').classList.add('hidden'); document.getElementById('createPresetModal').classList.remove('flex'); }
        function addExToPreset() {
            const name = document.getElementById('cpExSelect').value;
            const ref = FULL_EXERCISE_DB.find(e => e.name === name);
            const sets = document.getElementById('cpSets').value || 3;
            const reps = document.getElementById('cpReps').value || 10;
            tempPresetExercises.push({ name, sets: parseInt(sets), reps: ref.isTime?null:parseInt(reps), time: ref.isTime?parseInt(reps):null, type: ref.isTime?'Time Based':'Rep Based' });
            renderPresetExList();
        }
        function renderPresetExList() { document.getElementById('cpExerciseList').innerHTML = tempPresetExercises.map(e => `<div class="text-[10px] text-gray-300 flex justify-between border-b border-gray-800 pb-1"><span>${e.name}</span><span>${e.sets} x ${e.type==='Time Based'?e.time+'s':e.reps}</span></div>`).join(''); }
        function saveCustomPreset() {
            const name = document.getElementById('cpName').value;
            if(!name || tempPresetExercises.length === 0) return showToast("Invalid");
            db.customPresets['custom_'+Date.now()] = { name, desc: "Custom", exercises: tempPresetExercises };
            saveDB(); closePresetModal(); renderOperations(); showToast("Saved");
        }

        function checkQuestProgress(exName, amt) {
            let u = false;
            db.quests.forEach(q => { if(!q.done && exName.includes(q.type)) { q.current += amt; if(q.current >= q.target) { q.current=q.target; q.done=true; addXP(50); db.gold+=q.reward; showToast("Quest Complete"); } u=true; }});
            if(u) saveDB();
        }
        function renderQuests() {
            document.getElementById('quest-list').innerHTML = db.quests.map(q => `<div class="tech-panel p-4 clip-tech-sm border-l-4 ${q.done?'border-green-500 opacity-60':'border-yellow-500'}"><div class="flex justify-between items-start mb-2"><div><h3 class="text-white font-bold text-sm">${q.title}</h3><p class="text-[10px] text-gray-400 font-mono">${q.desc}</p></div><div class="text-yellow-400 font-mono text-xs">+${q.reward} CR</div></div><div class="w-full bg-gray-900 h-1.5 rounded-full overflow-hidden"><div class="h-full ${q.done?'bg-green-500':'bg-yellow-500'}" style="width: ${Math.min(100,(q.current/q.target)*100)}%"></div></div><div class="text-right text-[9px] text-gray-500 mt-1">${q.current} / ${q.target}</div></div>`).join('');
        }

        function renderProfile() {
            document.getElementById('pName').innerText = db.name; document.getElementById('pLvl').innerText = db.level;
            const ctx = document.getElementById('radarChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, { type: 'radar', data: { labels: Object.keys(db.mastery), datasets: [{ label: 'Mastery', data: Object.values(db.mastery), backgroundColor: 'rgba(6, 182, 212, 0.2)', borderColor: '#06b6d4', borderWidth: 2, pointBackgroundColor: '#fff' }] }, options: { scales: { r: { angleLines: { color: 'rgba(255,255,255,0.1)' }, grid: { color: 'rgba(255,255,255,0.1)' }, pointLabels: { color: '#94a3b8', font: { family: 'Share Tech Mono' } }, ticks: { display: false } } }, plugins: { legend: { display: false } }, maintainAspectRatio: false } });
            document.getElementById('stats-list').innerHTML = Object.keys(db.stats).map(k => `<div class="flex justify-between text-xs border-b border-gray-800 pb-1"><span class="text-gray-400 uppercase">${k}</span><span class="text-white font-mono font-bold">${db.stats[k].toFixed(1)}</span></div>`).join('');
        }

        function renderMarket() {
            document.getElementById('marketCredits').innerText = db.gold;
            document.getElementById('market-list').innerHTML = db.rewards.map(r => `<div class="tech-panel p-3 flex justify-between items-center group"><span class="text-white text-sm font-bold">${r.name}</span><button onclick="buyItem('${r.name}', ${r.cost})" class="text-[10px] bg-purple-900/30 border border-purple-500/50 text-purple-400 px-3 py-1 hover:bg-purple-500 hover:text-white transition-colors uppercase">${r.cost} CR</button></div>`).join('');
        }
        function buyItem(n, c) { if(db.gold >= c) { if(confirm("Buy?")) { db.gold -= c; saveDB(); renderMarket(); updateHeader(); showToast("Bought " + n); } } else showToast("Insufficient"); }
        function addCustomReward() { const n = document.getElementById('newRewardName').value, c = parseInt(document.getElementById('newRewardCost').value); if(n && c) { db.rewards.push({id:Date.now(), name:n, cost:c}); saveDB(); renderMarket(); } }

        function renderHistory() { document.getElementById('history-list').innerHTML = db.history.length ? db.history.map(h => `<div class="flex justify-between items-center border-b border-gray-800 pb-2"><div><div class="text-white">${h.desc}</div><div class="text-[9px] text-gray-500">${h.date}</div></div><div class="text-cyan-500">+${h.xp} XP</div></div>`).join('') : '<div class="text-gray-600 text-center">NO DATA</div>'; }
        
        function renderAchievements() {
            const c = document.getElementById('achievement-list');
            c.innerHTML = '';
            ACHIEVEMENTS.forEach(a => {
                const unlocked = db.achievements.includes(a.id);
                c.innerHTML += `<div class="tech-panel p-3 flex gap-3 ${unlocked ? 'border-green-500/50 bg-green-900/10' : 'grayscale opacity-50'}"><div class="text-2xl ${unlocked ? 'text-yellow-400' : 'text-gray-600'}"><i class="fa-solid fa-trophy"></i></div><div><div class="text-sm font-bold text-white">${a.name}</div><div class="text-[10px] text-gray-400 font-mono">${a.desc}</div></div>${unlocked ? '<div class="ml-auto text-green-500 text-xs"><i class="fa-solid fa-check"></i></div>' : ''}</div>`;
            });
        }
        function checkAchievements() {
            let newlyUnlocked = false;
            if(!db.achievements.includes('first_blood') && db.history.length > 0) { unlockAchievement('first_blood'); newlyUnlocked = true; }
            if(!db.achievements.includes('consistent') && db.streak >= 3) { unlockAchievement('consistent'); newlyUnlocked = true; }
            if(!db.achievements.includes('veteran') && db.level >= 5) { unlockAchievement('veteran'); newlyUnlocked = true; }
            if(!db.achievements.includes('rich') && db.gold >= 1000) { unlockAchievement('rich'); newlyUnlocked = true; }
            if(!db.achievements.includes('iron_body') && db.totalReps >= 1000) { unlockAchievement('iron_body'); newlyUnlocked = true; }
            if(newlyUnlocked) saveDB();
        }
        function unlockAchievement(id) { const a = ACHIEVEMENTS.find(x => x.id === id); db.achievements.push(id); db.gold += a.reward; showToast(`🏆 Unlocked: ${a.name}`); }

        function addXP(amt) { db.xp+=amt; if(db.xp>=db.xpNext) { db.xp-=db.xpNext; db.level++; db.xpNext=Math.floor(db.xpNext*1.5); document.getElementById('levelUpModal').classList.remove('hidden'); document.getElementById('levelUpModal').classList.add('flex'); } updateHeader(); }
        function closeLevelModal() { document.getElementById('levelUpModal').classList.add('hidden'); document.getElementById('levelUpModal').classList.remove('flex'); }
        function saveDB() { localStorage.setItem('glitchGymDB_v3', JSON.stringify(db)); updateHeader(); }
        function resetData() { if(confirm("RESET ALL DATA?")) { localStorage.removeItem('glitchGymDB_v3'); location.reload(); } }
        function showToast(msg) { const t = document.getElementById('toast'); document.getElementById('toastMsg').innerText = msg; t.style.transform = "translate(-50%, 0)"; setTimeout(() => t.style.transform = "translate(-50%, -150%)", 3000); }

    </script>
</body>
</html>
